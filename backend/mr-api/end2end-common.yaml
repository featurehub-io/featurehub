components:
  schemas:
    FeatureValueType:
      x-package: io.featurehub.mr.model
      type: string
      enum:
        - BOOLEAN
        - STRING
        - NUMBER
        - JSON
    RoleType:
      x-package: io.featurehub.mr.model
      type: string
      enum:
        - READ
        - LOCK
        - UNLOCK
        - CHANGE_VALUE
    BaseRolloutStrategy:
      x-package: io.featurehub.mr.model
      description: "if the feature in an environment is different from its default, this will be the reason for it.
                    a rollout strategy is defined at the Application level and then applied to a specific feature value.
                    When they are copied to the cache layer they are cloned and the feature value for that strategy
                    is inserted into the clone and those are published."
      properties:
        id:
          type: string
        percentage:
          description: "value between 0 and 1000000 - for four decimal places"
          type: integer
        percentageAttributes:
          type: array
          description: "if you don't wish to apply percentage based on user id, you can use one or more attributes defined here"
          items:
            type: string
        value:
          description: "when we attach the RolloutStrategy for Dacha or SSE this lets us push the value out. Only visible in SDK and SSE Edge."
        attributes:
          type: array
          items:
            $ref: "#/components/schemas/BaseRolloutStrategyAttribute"
    CacheRolloutStrategy:
      x-package: io.featurehub.dacha.model
      description: "This is the model for the rollout strategy as required by Dacha and Edge"
      allOf:
        - $ref: "#/components/schemas/RolloutStrategy"
        - type: object
          required:
            - id
            - percentage
            - value
            - attributes
    BaseRolloutStrategyAttribute:
      x-package: io.featurehub.mr.model
      # although they are required,  they aren't here because we need to validate against them
#      required:
#        - conditional
#        - fieldName
#        - type
      properties:
        id:
          type: string
          description: "A temporary id used only when validating. Saving strips these out as they are not otherwise necessary"
        conditional:
          $ref: "#/components/schemas/RolloutStrategyAttributeConditional"
        fieldName:
          type: string
        values:
          description: "the value(s) associated with this rule"
          type: array
          items:
            $ref: "#/components/schemas/RolloutStrategyArrayType"
        type:
          $ref: "#/components/schemas/RolloutStrategyFieldType"
    RolloutStrategyArrayType:
      x-package: io.featurehub.mr.model
      description: "values depend on the field type"
    RolloutStrategyFieldType:
      x-package: io.featurehub.mr.model
      type: string
      enum:
        - STRING
        - SEMANTIC_VERSION
        - NUMBER
        - DATE
        - DATETIME
        - BOOLEAN
        - IP_ADDRESS
    RolloutStrategyAttributeConditional:
      x-package: io.featurehub.mr.model
      type: string
      enum:
        - EQUALS
        - ENDS_WITH
        - STARTS_WITH
        - GREATER
        - GREATER_EQUALS
        - LESS
        - LESS_EQUALS
        - NOT_EQUALS
        - INCLUDES
        - EXCLUDES
        - REGEX
